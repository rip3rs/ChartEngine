'use strict';var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if('value'in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function')}}var ChartEngine=require('./App');var Highcharts=require('highcharts');var materialStyle=require('./styles/material');//Metrics
var Metrics=require('./services/metrics');//Filters
var DateFilters=require('./services/filters/dates');var FieldFilters=require('./services/filters/fields');var exportCharts=false;module.exports=function(){function CoreChart(endpoint,params,type){_classCallCheck(this,CoreChart);this.endpoint=endpoint;this.params=params;this.httpHeaders=prams.httpHeaders?params.httpHeaders:{};this.type=type;this.checkFilters();this.setDefaultParams();this.setMetrics();this.setExport()}_createClass(CoreChart,[{key:'setExport',value:function setExport(){if(exportCharts===false){require('highcharts-exporting')(Highcharts);require('highcharts-export-csv')(Highcharts);exportCharts=true}}},{key:'checkFilters',value:function checkFilters(){if(this.params.filters===undefined)this.params.filters={};this.dateFilters=new DateFilters(this.params.filters.dateFilters);this.fieldFilters=new FieldFilters(this.params.filters.fields)}},{key:'setStyle',value:function setStyle(){var head=document.querySelector('head');var materialStyleElement=document.querySelector('#materialDesignStyle');var fieldsStyleElement=document.querySelector('#fieldsStyle');var datesStyleElement=document.querySelector('#dateFiltersStyle');head.innerHTML+=materialStyleElement==null?'<style id="materialDesignStyle" >'+materialStyle+'</style>':'';head.innerHTML+=datesStyleElement==null?this.dateFilters.getStyle():'';head.innerHTML+=fieldsStyleElement==null?this.fieldFilters.getStyle():'';head.innerHTML+='<style>.chart-engine{display: flex;flex-direction: column;justify-content: center;}</style>'}},{key:'buildController',value:function buildController(name,args){ChartEngine.controller(name,args);this.render(name)}},{key:'getDomElements',value:function getDomElements(){var dom='';dom+='<div id="'+this.params.elApp+'Chart" ng-init="render()"></div>';dom+=this.dateFilters.render();dom+=this.fieldFilters.render();return dom}},{key:'render',value:function render(name){var app=document.querySelector('#'+this.params.elApp);app.classList.add('chart-engine');app.innerHTML=this.getDomElements();app.setAttribute('ng-controller',name);angular.bootstrap(app,['chartEngine']);this.setStyle()}},{key:'setDefaultParams',value:function setDefaultParams(){this.defaultParams={credits:{enabled:false},title:{text:this.params.title?this.params.title:''},subtitle:{text:this.params.subtitle?this.params.subtitle:''},xAxis:{categories:[]},yAxis:{title:{text:this.params.ytitle?this.params.ytitle:''},labels:{}},tooltip:{},legend:{layout:'vertical',align:'right',verticalAlign:'middle'},plotOptions:{dataLabels:{enabled:true}}}}},{key:'setMetrics',value:function setMetrics(){if(this.params.metric){this.defaultParams.yAxis.labels.formatter=Metrics[this.params.metric].yAxis;this.defaultParams.tooltip.formatter=Metrics[this.params.metric].tooltip}}},{key:'buildChart',value:function buildChart(elApp,series,type,defaultParams){defaultParams.chart={type:type};defaultParams.series=series;Highcharts.chart(elApp+'Chart',defaultParams)}},{key:'getResult',value:function getResult(formatData,result){var finalData=result.data.series;if(formatData!=undefined)finalData=formatData(result.data.series);return finalData}},{key:'getDefaultParams',value:function getDefaultParams(defaultParams,result){if(result.data.labels!=undefined)defaultParams.xAxis.categories=result.data.labels;return defaultParams}},{key:'getController',value:function getController(){var self=this;return function($scope,$http){$scope=self.fieldFilters.getVariables($scope);$scope.dataToSend={};$scope.dataToSend=self.dateFilters.getParams($scope.dataToSend);$scope.dataToSend=self.fieldFilters.getParams($scope.dataToSend);$scope.getParams=function(){var params={};for(var key in $scope.dataToSend){if($scope.dataToSend[key]!=undefined&&$scope.dataToSend[key]!=null){params[key]=$scope.dataToSend[key]}}return params};$scope.render=function(){$http.get(self.endpoint,{headers:self.httpHeaders,params:$scope.getParams()}).then(function(result){self.buildChart(self.params.elApp,self.getResult(self.formatData,result),self.type,self.getDefaultParams(self.defaultParams,result))})}}}}]);return CoreChart}();
//# sourceMappingURL=CoreChart.js.map
